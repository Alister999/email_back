Django Обработчик Ошибок с Отправкой по Email
Это Django-приложение демонстрирует кастомный механизм обработки ошибок, который перехватывает исключения, разбивает длинные трассировки ошибок на части и отправляет их асинхронно по электронной почте администраторам. Включает две вью: базовую главную страницу и страницу для генерации ошибки для демонстрации работы обработки ошибок и отправки писем.
Основные возможности

Кастомная обработка ошибок: Использует ChunkedAdminEmailHandler для перехвата ошибок, разбиения больших трассировок на части (по 5000 символов) и отправки их в виде отдельных писем.
Асинхронная отправка писем: Реализована через aiosmtplib и ThreadPoolExecutor для неблокирующей отправки.
Настраиваемое логирование: Интеграция с системой логирования Django для записи ошибок в консоль и файл, а также отправки уведомлений по email.
Конфигурация через переменные окружения: Использует .env для хранения чувствительных данных, таких как email-учетные данные.
Простой интерфейс: Включает базовую вью и вью для тестирования ошибок.

Требования

Python 3.8+
Django 4.0+
Необходимые Python-пакеты (см. requirements.txt ниже)
SMTP-сервер (например, Gmail SMTP) с действующими учетными данными
Файл .env с необходимыми переменными окружения

Установка

Клонируйте репозиторий:
git clone <URL-репозитория>
cd <директория-репозитория>


Создайте виртуальное окружение:
python -m venv venv
source venv/bin/activate  # Для Windows: venv\Scripts\activate


Установите зависимости:Создайте файл requirements.txt со следующим содержимым:
django==4.2
aiosmtplib==3.0.1
python-dotenv==1.0.1

Затем выполните:
pip install -r requirements.txt


Настройте переменные окружения:Создайте файл .env в корне проекта со следующим содержимым:
SECRET_KEY=ваш-секретный-ключ-django
EMAIL_PORT=587
EMAIL_HOST_USER=ваш-email@gmail.com
SEND_EMAIL=email-администратора@example.com
EMAIL_HOST_PASSWORD=пароль-для-email


Примените миграции:
python manage.py makemigrations
python manage.py migrate


Запустите сервер разработки:
python manage.py runserver



Структура проекта

email_back/: Основная директория Django-проекта.
settings.py: Настройки Django, включая конфигурацию логирования и email-бэкенда.
urls.py: Определяет маршруты URL приложения.


email_back/utils.py: Содержит ChunkedAdminEmailHandler для разбиения и отправки трассировок ошибок, а также утилиты для асинхронной отправки писем.
main_page/: Django-приложение с вью.
views.py: Содержит главную вью и вью для генерации ошибки.


debug.log: Файл логов для отладки и записи ошибок.
.env: Переменные окружения для чувствительных настроек.

Использование

Доступ к приложению:Откройте браузер и перейдите по адресу http://127.0.0.1:8000/. Вы увидите главную страницу.

Генерация ошибки:Перейдите по адресу http://127.0.0.1:8000/ и нажмите кнопку. Это вызовет исключение, активирующее ChunkedAdminEmailHandler.

Процесс обработки ошибок:

Трассировка ошибки перехватывается и разбивается на части по 5000 символов.
Каждая часть отправляется отдельным письмом на email администратора, указанный в settings.ADMINS.
Логи записываются в debug.log и выводятся в консоль.


Проверка писем:Убедитесь, что SMTP-настройки корректны. Email администратора (SEND_EMAIL в .env) получит письма с темами вида [Django] Ошибка (часть X/Y), содержащие части трассировки.


Логирование
Приложение использует систему логирования Django с тремя обработчиками:

Console: Выводит логи в терминал для отладки в реальном времени.
File: Записывает логи в файл debug.log для постоянного хранения.
ChunkedAdminEmailHandler: Отправляет трассировки ошибок по email для логов уровня ERROR от django.request.

Замечания по конфигурации

Настройки email: Убедитесь, что EMAIL_HOST_USER, EMAIL_HOST_PASSWORD и SEND_EMAIL корректно указаны в .env. Для Gmail может потребоваться пароль приложения, если включена двухфакторная аутентификация.
Режим DEBUG: В продакшене установите DEBUG = False для корректной обработки ошибок. В предоставленном settings.py уже установлено DEBUG = False.
ALLOWED_HOSTS: В данный момент установлено ['*'] для разработки. В продакшене укажите конкретные домены.

Тестирование
Для проверки обработки ошибок:

Убедитесь, что SMTP-сервер доступен и учетные данные верны.
Вызовите ошибку через endpoint /send/.
Проверьте email администратора на наличие писем с ошибками и убедитесь, что debug.log содержит соответствующие записи.

Устранение неполадок

Письма не отправляются: Проверьте SMTP-настройки и корректность EMAIL_HOST_PASSWORD. Просмотрите debug.log для деталей ошибок.
Логи не записываются в debug.log: Убедитесь, что есть права на запись в файл и что LOGGING настроен корректно в settings.py.
Большие трассировки: Размер части установлен на 5000 символов. При необходимости измените chunk_size в utils.py.

Вклад в проект
Приветствуются любые улучшения! Пожалуйста, создавайте pull request или открывайте issue для сообщений об ошибках, предложений или новых функций.
Лицензия
Проект распространяется под лицензией MIT.
